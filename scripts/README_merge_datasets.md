# æ•°æ®é›†åˆå¹¶å·¥å…·ä½¿ç”¨è¯´æ˜

è¿™ä¸ªå·¥å…·ç”¨äºåˆå¹¶é€šè¿‡`retarget_motion.py`ç”Ÿæˆçš„è¿åŠ¨æ•°æ®é›†ã€‚

## ğŸ“ æ”¯æŒçš„æ•°æ®æ ¼å¼

1. **å•ä¸ªè¿åŠ¨æ–‡ä»¶**: `motion_im.p` (åŒ…å«å•ä¸ªè¿åŠ¨çš„æ•°æ®)
2. **å¤šè¿åŠ¨æ•°æ®é›†**: `{dataset_name}.pkl` (åŒ…å«å¤šä¸ªè¿åŠ¨çš„å­—å…¸)

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤

```bash
python scripts/merge_datasets.py dataset1_path dataset2_path output_path
```

### å®Œæ•´å‚æ•°

```bash
python scripts/merge_datasets.py dataset1_path dataset2_path output_path \
    --prefix1 "walk_" \
    --prefix2 "run_" \
    --force
```

### å‚æ•°è¯´æ˜

- `dataset1_path`: ç¬¬ä¸€ä¸ªæ•°æ®é›†æ–‡ä»¶è·¯å¾„
- `dataset2_path`: ç¬¬äºŒä¸ªæ•°æ®é›†æ–‡ä»¶è·¯å¾„
- `output_path`: è¾“å‡ºåˆå¹¶æ•°æ®é›†çš„è·¯å¾„
- `--prefix1`: ç¬¬ä¸€ä¸ªæ•°æ®é›†çš„å‰ç¼€ï¼ˆè§£å†³é”®åå†²çªï¼‰
- `--prefix2`: ç¬¬äºŒä¸ªæ•°æ®é›†çš„å‰ç¼€ï¼ˆè§£å†³é”®åå†²çªï¼‰
- `--force`: å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„è¾“å‡ºæ–‡ä»¶

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åˆå¹¶ä¸¤ä¸ªå¤šè¿åŠ¨æ•°æ®é›†

```bash
python scripts/merge_datasets.py \
    data/unitree_g1_29dof/walking/walking.pkl \
    data/unitree_g1_29dof/running/running.pkl \
    data/unitree_g1_29dof/merged/walking_running.pkl \
    --prefix1 "walk_" \
    --prefix2 "run_"
```

### ç¤ºä¾‹2: åˆå¹¶å•ä¸ªè¿åŠ¨æ–‡ä»¶

```bash
python scripts/merge_datasets.py \
    data/unitree_g1_29dof/motion_im.p \
    data/unitree_g1_29dof/motion_im2.p \
    data/unitree_g1_29dof/merged_motions.pkl
```

### ç¤ºä¾‹3: ä½¿ç”¨ç¤ºä¾‹è„šæœ¬

```bash
python scripts/merge_example.py
```

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### âœ… æ•°æ®éªŒè¯
- è‡ªåŠ¨æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
- éªŒè¯å¿…éœ€å­—æ®µæ˜¯å¦å­˜åœ¨
- æ£€æŸ¥æ•°ç»„é•¿åº¦ä¸€è‡´æ€§
- éªŒè¯task_infoæ•°æ®æ ¼å¼

### ğŸ”„ å…¼å®¹æ€§æ£€æŸ¥
- æ£€æŸ¥FPSæ˜¯å¦ä¸€è‡´
- éªŒè¯å…³èŠ‚æ•°é‡åŒ¹é…
- æ¯”è¾ƒé»˜è®¤å…³èŠ‚è§’åº¦
- ç¡®ä¿æ•°æ®æ ¼å¼å…¼å®¹

### ğŸ·ï¸ é”®åå†²çªå¤„ç†
- è‡ªåŠ¨æ£€æµ‹é”®åå†²çª
- æ”¯æŒè‡ªå®šä¹‰å‰ç¼€è§£å†³å†²çª
- æ™ºèƒ½é‡å‘½åç­–ç•¥

### ğŸ“Š ç»Ÿè®¡ä¿¡æ¯
- æ˜¾ç¤ºè¿åŠ¨æ•°é‡
- è®¡ç®—æ€»å¸§æ•°å’Œæ—¶é•¿
- æ˜¾ç¤ºå¹³å‡FPS
- éªŒè¯ç»“æœæŠ¥å‘Š

## ğŸ“‹ æ•°æ®ç»“æ„

### è¾“å…¥æ•°æ®æ ¼å¼

```python
# å•ä¸ªè¿åŠ¨æ•°æ®
{
    "root_trans_offset": np.array,    # æ ¹éƒ¨ä½ç½®åç§»
    "dof": np.array,                  # å…³èŠ‚è§’åº¦
    "dof_increment": np.array,        # å¢é‡å…³èŠ‚è§’åº¦
    "default_joint_angles": np.array, # é»˜è®¤å…³èŠ‚è§’åº¦
    "root_rot": np.array,             # æ ¹éƒ¨æ—‹è½¬
    "smpl_joints": np.array,          # SMPLå…³èŠ‚ä½ç½®
    "fps": int,                       # å¸§ç‡
    "task_info": {                    # ä»»åŠ¡ä¿¡æ¯
        "target_vel": np.array,       # ç›®æ ‡é€Ÿåº¦
        "motion_type": np.array,      # è¿åŠ¨ç±»å‹
        "base_motion_flag": int       # åŸºç¡€è¿åŠ¨æ ‡å¿—
    }
}

# å¤šè¿åŠ¨æ•°æ®é›†
{
    "motion_key1": {å•ä¸ªè¿åŠ¨æ•°æ®},
    "motion_key2": {å•ä¸ªè¿åŠ¨æ•°æ®},
    ...
}
```

### è¾“å‡ºæ•°æ®æ ¼å¼

åˆå¹¶åçš„æ•°æ®é›†å§‹ç»ˆä¸ºå¤šè¿åŠ¨æ ¼å¼ï¼Œå³ä½¿è¾“å…¥æ˜¯å•ä¸ªè¿åŠ¨æ–‡ä»¶ä¹Ÿä¼šè¢«åŒ…è£…æˆå­—å…¸æ ¼å¼ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å…¼å®¹æ€§**: åªèƒ½åˆå¹¶å…³èŠ‚æ•°é‡ç›¸åŒçš„æ•°æ®é›†
2. **é”®åå†²çª**: å»ºè®®ä½¿ç”¨å‰ç¼€å‚æ•°é¿å…è¿åŠ¨åç§°å†²çª
3. **å†…å­˜ä½¿ç”¨**: å¤§æ•°æ®é›†åˆå¹¶å¯èƒ½éœ€è¦è¾ƒå¤šå†…å­˜
4. **å¤‡ä»½æ•°æ®**: å»ºè®®åœ¨åˆå¹¶å‰å¤‡ä»½åŸå§‹æ•°æ®

## ğŸ› å¸¸è§é—®é¢˜

### Q: æç¤º"å…³èŠ‚æ•°é‡ä¸åŒ¹é…"
A: ç¡®ä¿ä¸¤ä¸ªæ•°æ®é›†ä½¿ç”¨ç›¸åŒçš„æœºå™¨äººé…ç½®(å¦‚éƒ½æ˜¯unitree_g1_29dof)

### Q: æç¤º"æ•°æ®é›†æ–‡ä»¶ä¸å­˜åœ¨"
A: æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿å·²é€šè¿‡retarget_motion.pyç”Ÿæˆæ•°æ®

### Q: é”®åå†²çªå¦‚ä½•å¤„ç†ï¼Ÿ
A: ä½¿ç”¨`--prefix1`å’Œ`--prefix2`å‚æ•°ä¸ºå†²çªçš„é”®æ·»åŠ å‰ç¼€

### Q: å¦‚ä½•æŸ¥çœ‹åˆå¹¶ç»“æœï¼Ÿ
A: å¯ä»¥ä½¿ç”¨joblib.load()åŠ è½½åˆå¹¶åçš„æ–‡ä»¶ï¼ŒæŸ¥çœ‹åŒ…å«çš„è¿åŠ¨åˆ—è¡¨

## ğŸ“– ç›¸å…³å·¥å…·

- `retarget_motion.py`: ç”Ÿæˆè¿åŠ¨æ•°æ®é›†
- `merge_example.py`: åˆå¹¶ä½¿ç”¨ç¤ºä¾‹
- å…¶ä»–åˆ†æå’Œå¯è§†åŒ–å·¥å…·

## ğŸ”— æ›´å¤šä¿¡æ¯

è¿è¡Œ`python scripts/merge_datasets.py --help`æŸ¥çœ‹å®Œæ•´å‚æ•°è¯´æ˜ã€‚ 